# Инструкция по работе с npm для Stilusjs

## 1. Подготовка проекта к публикации

### Первоначальная настройка
- **Создание package.json**:
  ```bash
  npm init
  ```
- **Обязательные поля в package.json**:
  - `name` — имя пакета
  - `version` — версия (обычно начинают с 0.1.0)
  - `main` — точка входа в пакет (обычно dist/index.js)
  - `files` — файлы, которые будут включены в пакет:
    ```json
    "files": ["dist", "README.md"]
    ```
  - `description` — описание проекта
  - `keywords` — ключевые слова для поиска
  - `author` — автор пакета
  - `license` — лицензия (обычно MIT)

### Настройка игнорируемых файлов
- **Создание .npmignore**:
  ```
  src/
  node_modules/
  .vscode/
  .idea/
  tests/
  examples/
  ```

## 2. Регистрация и аутентификация

### Регистрация на npmjs.com
- Создайте аккаунт на [npmjs.com](https://www.npmjs.com/signup)

### Аутентификация в командной строке
```bash
npm login
```
Введите свои учетные данные (имя пользователя, пароль, email)

### Проверка аутентификации
```bash
npm whoami
```

## 3. Сборка проекта

### Скрипт сборки
- Должен быть настроен скрипт сборки в package.json:
  ```json
  "scripts": {
    "build": "rollup -c" 
  }
  ```

### Запуск сборки
```bash
npm run build
```

## 4. Публикация проекта

### Первая публикация
```bash
npm publish
```

### Публикация с указанием доступа
```bash
npm publish --access public
```

### Публикация предварительной версии
```bash
npm publish --tag beta
```

## 5. Управление версиями

### Обновление версий
- **Патч-версия** (исправление ошибок):
  ```bash
  npm version patch
  ```
  Например: 1.0.0 → 1.0.1

- **Минорная версия** (новые функции, обратная совместимость):
  ```bash
  npm version minor
  ```
  Например: 1.0.1 → 1.1.0

- **Мажорная версия** (несовместимые изменения API):
  ```bash
  npm version major
  ```
  Например: 1.1.0 → 2.0.0

### Предрелизные версии
- **Альфа-версия**:
  ```bash
  npm version prerelease --preid=alpha
  ```
  Например: 1.0.0 → 1.0.1-alpha.0

- **Бета-версия**:
  ```bash
  npm version prerelease --preid=beta
  ```
  Например: 1.0.0 → 1.0.1-beta.0

- **Кандидат на релиз**:
  ```bash
  npm version prerelease --preid=rc
  ```
  Например: 1.0.0 → 1.0.1-rc.0

## 6. Обновление пакета

### Полный процесс обновления
```bash
# 1. Внесите изменения в код
# 2. Соберите проект
npm run build

# 3. Обновите версию
npm version patch
# или
npm version minor
# или
npm version major

# 4. Опубликуйте обновленную версию
npm publish
```

## 7. Дополнительные команды

### Локальное тестирование
```bash
# Создание архива пакета
npm pack

# Установка локального пакета в другом проекте
npm install /путь/к/архиву/имя-пакета-1.0.0.tgz
```

### Просмотр информации о пакете
```bash
npm view имя-пакета
```

### Удаление опубликованной версии
```bash
# Удаление конкретной версии (возможно только в течение 72 часов)
npm unpublish имя-пакета@1.0.0

# Удаление всего пакета (с ограничениями)
npm unpublish имя-пакета --force
```

### Помечание версии как устаревшей
```bash
npm deprecate имя-пакета@"< 1.0.0" "Версия устарела, используйте 1.x.x"
```

## 8. Скрытые/предварительные версии

### Публикация с тегом
```bash
npm publish --tag next
```

### Установка конкретного тега
```bash
npm install имя-пакета@next
```

### Управление тегами
```bash
# Просмотр тегов
npm dist-tag ls имя-пакета

# Добавление тега к версии
npm dist-tag add имя-пакета@1.0.0 latest

# Удаление тега
npm dist-tag rm имя-пакета next
```

## 9. Рекомендации и лучшие практики

- **README.md**: Создайте подробную документацию с примерами использования
- **CHANGELOG.md**: Ведите список изменений для каждой версии
- **Тестирование**: Протестируйте пакет локально перед публикацией
- **Семантическое версионирование**: Строго соблюдайте правила MAJOR.MINOR.PATCH
- **Организации**: Для командных проектов используйте области видимости `@organization/package-name`
- **Двухфакторная аутентификация**: Включите 2FA в настройках npm для безопасности
- **CI/CD**: Настройте автоматическую публикацию через CI/CD для стабильных релизов

## 10. Решение распространенных проблем

- **403 Forbidden**: Проверьте права доступа и аутентификацию
- **конфликт версий**: Убедитесь, что версия не была ранее опубликована
- **Ошибка имени пакета**: Убедитесь, что имя уникально и соответствует правилам npm

## 11. Система версионирования (SemVer)

В npm используется семантическое версионирование (Semantic Versioning, SemVer), которое состоит из трех чисел: **MAJOR.MINOR.PATCH** (мажорная.минорная.патч).

### Основные правила версионирования

1. **PATCH** (0.1.0 → 0.1.1):
   - Обновляется при исправлении багов
   - Никаких нарушений обратной совместимости
   - Команда: `npm version patch`

2. **MINOR** (0.1.1 → 0.2.0):
   - Обновляется при добавлении новой функциональности
   - Сохраняет обратную совместимость (старый код работает)
   - Команда: `npm version minor`

3. **MAJOR** (0.2.0 → 1.0.0):
   - Обновляется при несовместимых изменениях API
   - Могут потребоваться изменения в коде пользователей
   - Команда: `npm version major`

### Начальные версии

- Разработка обычно начинается с версии **0.1.0**
- Версии **0.y.z** считаются нестабильными, в разработке
- API может меняться без предупреждения до версии 1.0.0

### Переход от 0.y.z к 1.0.0

Когда выпускать версию 1.0.0:
- API стабилизировался и считается надежным
- Библиотека готова к использованию в продакшн
- Вы уверены в обратной совместимости и готовы поддерживать API
- Библиотека имеет достаточный функционал для реальных приложений

## 12. Локальное тестирование библиотеки Stilusjs

Для локального тестирования библиотеки:

1. Соберите библиотеку: `npm run build`
2. Создайте тестовый React-проект в отдельной папке: `npx create-react-app test-stilusjs` или `npm create vite@latest test-stilusjs -- --template react-ts`
3. Перейдите в директорию с вашей библиотекой и выполните `npm pack` - это создаст архив вида `stilusjs-0.1.0.tgz`
4. В тестовом проекте установите библиотеку: `npm install ../путь-к-архиву/stilusjs-0.1.0.tgz`
5. Используйте библиотеку в тестовом проекте, как обычно: `import { StilusjsEditor } from 'stilusjs';` 